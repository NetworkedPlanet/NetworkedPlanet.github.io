<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Loading data from SPARQL Endpoints into Excel Power Map</title>
    <meta name="description" content="23 Jul 2013 - Following on from the previous post about Visualizing data in Excel, I decided to have a look at how easy it would be...">
	<meta name="robots" content="NOODP">
	
	<!-- Twitter Summary Card  -->
	
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@nwplanet" />
	<meta name="twitter:title" content="Loading data from SPARQL Endpoints into Excel Power Map" />
	<meta name="twitter:description" content="Following on from the previous post about Visualizing data in Excel, I decided to have a look at how easy it would be to load data from a SPARQL endpoint into an Excel Power Map.

" />
	
	<!-- OpenGraph summary -->
	<meta name="og:title" content="Loading data from SPARQL Endpoints into Excel Power Map" />
	<meta name="og:description" content="Following on from the previous post about Visualizing data in Excel, I decided to have a look at how easy it would be to load data from a SPARQL endpoint into an Excel Power Map.

" />
	

    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://networkedplanet.com/feed/" />
    <link rel="alternate" type="application/rss+xml" title="NetworkedPlanet &raquo; Feed" href="http://networkedplanet.com/feed/" />

    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/cookiecuttr.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <link rel="canonical" href="http://networkedplanet.com/blog/2013/07/23/loading-data-from-sparql-endpoints-into-excel-power-map.html">
    
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
	<div class="navbar-header">
	  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
		<span class="sr-only">Toggle navigation</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	  </button>
	  <a class="navbar-brand page-scroll" href="/#page-top"><img src="/assets/images/np_header.png" alt="NetworkedPlanet"/></a>
	</div>
	<div id="navbar" class="navbar-collapse collapse">
	  <ul class="nav navbar-nav">
		<li class="hidden">
			<a class="page-scroll" href="#page-top"></a>
		</li>
		<li>
			<a class="page-scroll" href="/#products">Products</a>
		</li>
		<li>
			<a class="page-scroll" href="/#services">Services</a>
		</li>
		<li>
			<a class="page-scroll" href="/#training">Training</a>
		</li>
		<li>
			<a class="page-scroll" href="/#contact">Contact Us</a>
		</li>
		<li>
			<a href="/support/">Support</a>
		</li>
		<li>
			<a href="/blog/">Blog</a>
		</li>
	  </ul>
	</div>
  </div>
</nav>


    <div class="container">
        <div class="post">

	<div class="spacer-top"></div>
	


<div class="container">

<ol class="breadcrumb">
 
  <li><a href="/">Home</a></li>

  
   
   

   <li><a href="/blog/">Blog</a></li>

   
  
 
 <li>Loading data from SPARQL Endpoints into Excel Power Map</li>
</ol>
</div>
	
  <header class="post-header">
    <h1 class="post-title">Loading data from SPARQL Endpoints into Excel Power Map</h1>
    <p class="post-meta">Jul 23, 2013 • JW</p>
  </header>

  <article class="post-content">
	
    <p>Following on from the previous post about <a href="http://www.networkedplanet.com/visualising-data-in-excel/">Visualizing data in Excel</a>, I decided to have a look at how easy it would be to load data from a SPARQL endpoint into an Excel Power Map.</p>

<p><a href="http://www.w3.org/TR/sparql11-results-csv-tsv/">SPARQL 1.1 supports a return format of CSV</a>, which makes it straightforward to write a query that returns a useful set of data to load into Excel.</p>

<p>DBpedia has various resources that contain longitude and latitude data, and has a very handy <a href="http://dbpedia.org/sparql">SPARQL endpoint complete with query editor</a>, so the first thing to do is to write a query to return data that shows people’s birth places over time.</p>

<h3>Writing the query</h3>

<p>Load the <a href="http://dbpedia.org/sparql">DBpedia SPARQL Query Editor</a> in your browser, and set the results format to HTML. This will display the results in the same webpage in an HTML tabular format so that you can adjust your query before downloading any CSV. Enter the SPARQL shown below into the Query Text field.</p>

<pre>select distinct ?p ?name ?dob ?birthPlace ?lat ?long where {

?p a dbpedia-owl:Person . 

?p foaf:name ?name . 

?p dbpedia-owl:birthDate ?dob .

?p dbpedia-owl:birthPlace ?bp . 

?bp a dbpedia-owl:Settlement .

?bp foaf:name ?birthPlace . 

?bp geo:lat ?lat . 

?bp geo:long ?long . 

}

LIMIT 250</pre>

<p>This returns resources of type dbpedia-owl:Person whose birth place was of type dbpedia-owl:Settlement (to narrow down the birth place to as specific an area as possible). The query also returns the name and date of birth of the person, and latitude, longitude and name of the birth place.</p>

<p>Viewing this in the browser we can see a number of duplicates, and for the purposes of this example we’ll narrow the data to those in the UK and the Republic of Ireland. To do this, amend the query to the following:</p>

<pre>select distinct ?p as ?id SAMPLE(?name) as ?name SAMPLE(?dob) as ?dob SAMPLE(?birthPlace) as ?birthPlace SAMPLE(?lat) as ?latitude SAMPLE(?long) as ?longitude 

where {

?p a dbpedia-owl:Person . 

?p foaf:name ?name . 

?p dbpedia-owl:birthDate ?dob .

?p dbpedia-owl:birthPlace ?bp . 

?bp a dbpedia-owl:Settlement .

?p dbpedia-owl:birthPlace ?bp2 . 

{ ?bp2 dbpedia-owl:country dbpedia:United_Kingdom } UNION { ?bp2 dbpedia-owl:country dbpedia:Republic_of_Ireland } . 

?bp foaf:name ?birthPlace . 

?bp geo:lat ?lat . 

?bp geo:long ?long . } 

GROUP BY ?p 

LIMIT 1000</pre>

<p><img class="aligncenter size-large wp-image-1423" alt="html" src="/assets/images/2013/07/html-660x337.png" width="660" height="337" /></p>

<p>Click “Run Query” to check the results, and then up the LIMIT to 250000 and set the Results Format to CSV. This will download a file named “sparql” to your computer. Go to the downloaded file and rename it to <strong>dbpedia_personbirth.csv</strong>.</p>

<h3>Loading and viewing the data</h3>

<p><em>Before opening Excel, make sure you have <a href="http://www.networkedplanet.com/visualising-data-in-excel/">installed Power Query and Power Map</a> as explained in the previous blog post.</em></p>

<p>Open Excel, click the Power Query tab and select Import &gt; From File &gt; CSV and open <strong>dbpedia_personbirth.csv </strong>in the Query Editor.</p>

<p><img class="aligncenter size-large wp-image-1380" alt="import" src="/assets/images/2013/07/import-660x474.png" width="660" height="474" /></p>

<p> </p>

<p>Our SPARQL query was very selective when returning variables, so we don’t need to remove any columns from the import query, so click “Done”.</p>

<p>Wait for the data to load completely, and then click “Load to Data Model” in the Query Settings section, after this is complete, open the Insert tab and hit the GeoFlow &gt; Map &gt; Launch GeoFlow. This launches a new Power Map Tour window, and clicking on the <strong>latitude</strong> and <strong>longitude</strong> columns autofills the options in the “Geography” section ready to hit “Map It”</p>

<p><img class="aligncenter size-large wp-image-1383" alt="powermap1" src="/assets/images/2013/07/powermap1-660x382.png" width="660" height="382" /></p>

<p>Once the data has been mapped we can see some strange data, namely the points of red over in the USA and elsewhere on the globe (shown below); very strange considering the data was filtered to the UK and Ireland! But we’ll come back to that later as we can see that the majority of the data is indeed on the British Isles.</p>

<p><img class="aligncenter size-large wp-image-1384" alt="mapit" src="/assets/images/2013/07/mapit-660x488.png" width="660" height="488" /></p>

<p>Now that the data is mapped, select <strong>dob</strong> which is entered into the “Time” field and then change the Chart Type to “HeatMap”.</p>

<p>As Power Query recognises that the <strong>dob</strong> field contains dates, it converts them to Date types in the Excel workbook. Power Map in turn recognises the date fields, and when it is selected loads the field into “Time” - this also displays a floating date display over the map, and adds playback controls to the bottom of the screen.</p>

<p><img class="aligncenter size-medium wp-image-1407" alt="playback control" src="/assets/images/2013/07/Capture-300x62.png" width="300" height="62" /></p>

<p>Press the Play button to start the data visualization and you will see the map changing over time as pinpoints are added to the heatmap as the data loads another person’s date of birth, and adds the location of their birth place to the map (as shown in the screenshots below).</p>

<p><img class="alignleft size-medium wp-image-1387" alt="1" src="/assets/images/2013/07/1-300x222.png" width="300" height="222" /><img class="alignleft size-medium wp-image-1387" alt="2" src="/assets/images/2013/07/2-300x222.png" width="300" height="222" /><img class="alignleft size-medium wp-image-1387" alt="3" src="/assets/images/2013/07/3-300x222.png" width="300" height="222" /><img class="alignleft size-medium wp-image-1387" alt="4" src="/assets/images/2013/07/4-300x222.png" width="300" height="222" /><img class="alignleft size-medium wp-image-1387" alt="5" src="/assets/images/2013/07/5-300x222.png" width="300" height="222" /><img class="alignleft size-medium wp-image-1387" alt="6" src="/assets/images/2013/07/6-300x222.png" width="300" height="222" /></p>

<p><br class="list" /></p>

<p>Following the steps above shows how you can easily query data from a SPARQL endpoint, and then quickly load and manipulate the data (if required) using Excel Power Query, and then view that data using Excel Power Map.</p>

<p> </p>

<h3>Investigating Strange Data</h3>

<p>As mentioned above, when the data was first loaded into Power Map - we can see some pinpoints outside of the UK, which are not expected given that the query is written to filter down to only UK results. To check out these pin points of confusing data, we can load the <strong>id</strong> field on the Power Map. Loading every ID slows down the visualization tool significantly, but is worth doing for investigation into the the odds lines of data. Zooming in on a pin point in the USA and clicking on the pin point (when the chart type is set to “Column”) displays the information of that point, and we can type the ID shown directly into our browser to load up the page in DBpedia.</p>

<p>For example, one of the points of “bad data” near Chicago shows the id</p>

<pre>http://dbpedia.org/page/Bill_Brennan</pre>

<p>Loading this up in the browser shows that <a href="http://dbpedia.org/page/Bill_Brennan">Bill Brennan</a> has multiple possible birth places of Chicago, and County Mayo, Ireland. This may simply be that the person’s birth place is not actually known.</p>

<p>Clicking on the point of data with the earliest birth date is surprising, as instead of showing a Roman Emporer or similar, instead the ID was shown for <a href="http://dbpedia.org/page/Chris_Smalling">Chris Smalling</a>. Going to the resource page for Chris Smalling shows his birth data as 22nd November 0198. An obvious data entry/clean up error as the dbpprop property shows the birth date as 22nd Nov 1989.</p>

<p>This shows how loading data into a visualization tool can help us spot “bad” data very quickly and investigate it, without having to read hundreds of lines of text on a spreadsheet.</p>

<h3>Troubleshooting dates in Power Map</h3>

<p>Whilst writing this blog post I had trouble replicating the stages of loading the data into the Power Map as there was a problem with the <strong>dob</strong> field. Excel Power Query was not converting any dates with a year previous to 1900 properly for use in the playback Time field in the visualization. The solution to this problem was to click the <strong>Load to Data Model</strong> option after the data had initially loaded from the CSV file, and before loading the data to a Power Map. The post above has been updated to include this step.</p>

  </article>

  <div class="row spacer2">&nbsp;</div>
  
  <hr/>
  <nav>
    <p>Filed under:  <a href="/blog/tags/sparql/">sparql</a></p>
    <p class="clearfix">
        
            <span class="pull-left">
                <a class="btn btn-primary" href="/blog/2013/07/17/visualising-data-in-excel.html" role="previous">&lt;&lt; Visualizing Data In Excel</a>
            </span>
        
        
        <span class="pull-right">
            <a class="btn btn-primary" href="/blog/2013/08/07/brightstardb-1-4-alpha-release.html" role="next">BrightstarDB 1.4 alpha release &gt;&gt;</a>
        </span>
        
    </p>
  </nav>
  <hr/>
  
</div>
<div class="spacer2">&nbsp;</div>

    </div>

    <footer class="footer">
    <div class="container">
        <div class="spacer">&nbsp;</div>
        <div class="row">
            <div class="col-xs-6">
                <p>&copy; 2016 Networked Planet Limited.</p>
            </div>
            <div class="col-xs-6">
                <div class="pull-right">
                    <a href="#">Back to top</a>
                </div>
            </div>
        </div> <!-- /.row -->
        <div class="row">
            <div class="col-xs-12">
                <small class="text-muted">Registered in England no. 5273377 Registered Office: 17 Cosgrove Road, Old Stratford, Milton Keynes, MK19 6AG</small>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- Bootstrap plugins -->
<script src="/assets/javascripts/bootstrap.min.js"></script>
<script src="/assets/javascripts/scrolling-nav.js"></script>
<script src="/assets/javascripts/jquery.easing.min.js"></script>

<!-- CookieCuttr script -->
<script src="/assets/javascripts/js.cookie-1.5.1.min.js"></script>
<script src="/assets/javascripts/jquery.cookiecuttr.js"></script>
<script>
    $(document).ready(function() {
        $.cookieCuttr({cookieDeclineButton: true});
    });
    
    if (jQuery.cookie('cc_cookie_decline') == "cc_cookie_decline") {
        // do nothing
    } else {
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
		 ga('create', 'UA-770913-1', 'auto', { 'allowLinker': true });
		ga('require', 'linker');
		ga('linker:autoLink', ['testing.networkedplanet.com']);
		ga('linker:autoLink', ['levelup.networkedplanet.com']);
		ga('linker:autoLink', ['support.networkedplanet.com']);
		ga('send', 'pageview');
		
    }
</script>
<script>
/**
* Function that tracks a click on an outbound link in Google Analytics.
* Example of use:
* <a href="http://www.example.com" onclick="trackOutboundLink('http://www.example.com'); return false;">Check out example.com</a>
*/
var trackOutboundLink = function(url) {
	// Only track if the cookie was not declined
	if (ga){
	    ga('send', 'event', 'outbound', 'click', url, {
		   'transport': 'beacon',
		   'hitCallback': function(){document.location = url;}
	    });
   }
}
</script>


    </body>

</html>
